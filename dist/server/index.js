parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r},p.cache={};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"Jbsu":[function(require,module,exports) {
const n=require("dotenv");"production"!==process.env.NODE_ENV&&n.config(),module.exports={development:{client:"pg",connection:"postgresql://wunderpong:wunderpong@localhost:5432/d89mdaft5ocbms"},production:{client:"pg",connection:process.env.DATABASE_URL},test:{client:"pg",connection:"postgresql://wunderpong:wunderpong@localhost:5432/wunderpong_test"}};
},{}],"sTyA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.rollback=exports.runMigrations=exports.knex=void 0;var e=t(require("knex")),r=t(require("path"));function t(e){return e&&e.__esModule?e:{default:e}}const o=require("../knexfile.js"),s=process.env.NODE_ENV||"development",i=r.default.join(__dirname,"../migrations"),n=(0,e.default)(o[s]);exports.knex=n;const a=()=>n.migrate.latest({directory:i});exports.runMigrations=a;const l=()=>n.migrate.rollback({directory:i});exports.rollback=l;
},{"../knexfile.js":"Jbsu"}],"/lk7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.deleteMatch=exports.getMatches=exports.postMatch=void 0;var e=require("../db");const t=5184e6,r=async(t,r)=>(0,e.knex)("matches").insert({winner:t,loser:r});exports.postMatch=r;const s=async()=>e.knex.select("*").from("matches").where("created_at",">=",new Date(Date.now()-5184e6)).orderBy("created_at","asc");exports.getMatches=s;const c=async t=>(0,e.knex)("matches").del().whereIn("id",e=>{e.select("id").from("matches").where({winner:t}).orWhere({loser:t}).orderBy("id","desc").limit(1)});exports.deleteMatch=c;
},{"../db":"sTyA"}],"htcU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeImage=exports.saveImage=void 0;var e=t(require("fs"));function t(e){return e&&e.__esModule?e:{default:e}}const s="./uploads/",r=()=>{e.default.existsSync(s)||e.default.mkdirSync(s)},n=async t=>new Promise((r,n)=>{e.default.existsSync(s)||e.default.mkdirSync(s);const a=`./uploads/${`screenshot_${Date.now()}.jpg`}`;e.default.writeFile(a,t,e=>{if(e)return n(e);r(a)})});exports.saveImage=n;const a=t=>{if(e.default.existsSync(s))return e.default.unlinkSync(t)};exports.removeImage=a;
},{}],"jWsf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e={asyncHandler:!0,getLadder:!0};exports.getLadder=exports.asyncHandler=void 0;var r=n(require("arpad")),t=require("./image-utils");function n(e){return e&&e.__esModule?e:{default:e}}Object.keys(t).forEach(function(r){"default"!==r&&"__esModule"!==r&&(Object.prototype.hasOwnProperty.call(e,r)||Object.defineProperty(exports,r,{enumerable:!0,get:function(){return t[r]}}))});const a=e=>(r,t,n)=>Promise.resolve(e(r,t,n)).catch(n);exports.asyncHandler=a;const o=e=>{const t=new r.default,n=e.reduce((e,r)=>{const n=e[r.winner]||1500,a=e[r.loser]||1500;return e[r.winner]=t.newRatingIfWon(n,a),e[r.loser]=t.newRatingIfLost(a,n),e},{});return Object.keys(n).map(e=>({name:e,rating:n[e]})).sort((e,r)=>r.rating-e.rating)};exports.getLadder=o;
},{"./image-utils":"htcU"}],"lY9v":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=l(require("express")),t=l(require("path")),a=l(require("cors")),s=l(require("body-parser")),n=l(require("lodash.uniq")),o=l(require("lodash.flatten")),r=require("./db/matches"),i=require("./utils");function l(e){return e&&e.__esModule?e:{default:e}}const c=(0,e.default)();c.use((0,a.default)()),c.use(s.default.json()),c.use(s.default.urlencoded({extended:!0})),c.use(e.default.static("dist/client")),c.post("/api/match",async(e,t)=>{console.info("POST /api/match");const{text:a}=e.body;if(!a)return t.sendStatus(400);const s=a.split(" ").filter(e=>Boolean(e.trim())).map(e=>e.toLowerCase().trim().replace(/[^a-z_]/gi,""));if(2!==s.length)return t.sendStatus(400);const n=s[0],o=s[1];if(n===o)return t.sendStatus(400);await(0,r.postMatch)(n,o),t.status(200).json({text:`Got it, ${n.replace(/_{1,}/gi," ")} won ${o.replace(/_{1,}/gi," ")} 🏆 \n _ps. if you made a mistake, DON'T make mistakes!_`})}),c.post("/api/match/undo",(0,i.asyncHandler)(async(e,t)=>{const{text:a}=e.body,s=a.trim().replace(/[^a-z_]/gi,"");await(0,r.deleteMatch)(s),t.status(200).json({text:"Your latest match result has been cancelled. You can now submit the corrected result."})})),c.get("/api/matches",(0,i.asyncHandler)(async(e,t)=>{console.info("GET /api/matches");const a=await(0,r.getMatches)();t.status(200).json(a)})),c.post("/api/ladder",(0,i.asyncHandler)(async(e,t)=>{console.info("POST /api/ladder");const a=await(0,r.getMatches)(),s=(0,i.getLadder)(a);t.status(200).json({text:">>> \n"+s.map((e,t)=>`${t+1}. ${e.name}${0===t?" 👑":""}`).join("\n")})})),c.get("/api/ladder",(0,i.asyncHandler)(async(e,t)=>{console.info("GET /api/ladder");const a=await(0,r.getMatches)(),s=(0,i.getLadder)(a);t.status(200).json(s)})),c.get("/api/players",(0,i.asyncHandler)(async(e,t)=>{console.info("GET /api/players");const a=await(0,r.getMatches)(),s=(0,n.default)((0,o.default)(a.map(e=>[e.winner,e.loser]))).sort();t.status(200).json(s)})),c.post("/api/whoisit",(0,i.asyncHandler)(async(e,t)=>{console.log("POST /api/whoisit"),t.json({players:[]})})),c.get("*",(e,a)=>{a.sendFile(t.default.resolve(__dirname+"/../dist/client/index.html"))}),c.use((e,t,a,s)=>{console.error("[ERROR]",e),a.sendStatus(500)});var d=c;exports.default=d;
},{"./db/matches":"/lk7","./utils":"jWsf"}],"Focm":[function(require,module,exports) {
require("babel-register")({}),require("babel-polyfill");const e=require("./db"),r=require("./App").default,i=process.env.PORT||3e3;e.runMigrations().then(()=>{r.listen(i,()=>{console.log(`Server listening port -> ${i}`)})});
},{"./db":"sTyA","./App":"lY9v"}]},{},["Focm"], null)